# Design Instagram

### Problem 
Design a photo-sharing service like Instagram where users can upload and share images with others.

Example:
- https://instagram.com

### Questions:

1. Is the system read-heavy or write-heavy?
    - Read heavy

2. Is it a distributed system or a single server?
    - Distributed System

3. Which is more important: Consistency or Availability?
    - Availability

4. How many new images are expected to be uploaded monthly?
    - 1 billion new images
      
5. Are there events that lead to a spike in activity?
    - Any events like concerts, or holidays like Christmas might lead to a spike in activity.

6. What is the read-to-write ratio?
    - 10:1
    
7. What is the maximum file size allowed to upload?
    - 10 MB
  
8. What is the average file size of images?
    - 200 KB
  
### Functional Requirements

|      | 
| ----------- | 
| 1. Users can upload/download/view photos.      | 
| 2. Users can search for photos based on the title.   | 
| 3. Users can follow other users.|
| 4. Newsfeed is generated by the system, consisting of top photos of the people followed by the user. |

### Non-Functional Requirements

|      | 
| ----------- | 
| 1. High Reliability (no user upload should be lost)   | 
| 2. High Availability   | 
| 3. Low latency, acceptable latency for NewsFeed generation is 200ms | 
| 4. Scalable|

## Capacity Estimation

### 1. Traffic Estimates

Since the read-to-write ratio is 10:1 and we are expected to have 1 billion photos uploaded monthly, 
so the total number of reads monthly will be:

 - 10 * 1 billion = 10 billion reads

Read and write in seconds:

 - 1 billion / (30 days * 24 hours * 3600 seconds) = 385 photos uploaded per second

 - 10 * 385 = 3850 reads per second

### 2. Storage Estimates

Total storage required for 1 month:

 - 1 billion * 200 KB *  = 200TB

Total storage required for 1 year:

 - 200TB * (1 year * 12 months) = 2400 TB

Total storage required for 10 years:

 - 2400TB * 10 years = 24 PB

### 3. Network Estimates

For write requests per second:

 - 385 * 200KB = 77 MB/s

For read requests per second:

 - 3850 * 200KB = 770 MB/s


### 4. Memory Estimates

We will cache 20% of the requests (following the 80:20 principle where 20% of work provides 80% of the result)

Since we have 3850 requests per second, so we have:

 - 3850 * (24 hours * 3600 seconds) =~ 300 million requests daily

To cache 20% of the request, the amount of memory needed is:

 - 0.2 * 300 million * 200KB = 12 TB
