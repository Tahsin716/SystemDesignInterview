# Design Twitter

### Problem 
Design a social networking service like Twitter where users can post tweets, and follow other people and favorite tweets.

### Questions:

1. Is the system read-heavy or write-heavy?
    - Read heavy

2. Is it a distributed system or a single server?
    - Distributed System

3. Which is more important: Consistency or Availability?
    - Availability

4. How many tweets are expected daily?
    - 100 million tweets
      
5. Are there events that lead to a spike in activity?
    - Yes, breaking news and emergencies, live events and sporting matches, etc, can lead to a spike in events.

6. What is the read-to-write ratio?
    - 100:1
    
7. What is the average size of each tweet size?
    - 200 bytes

8. How many Daily Active Users does the system have?
    - 200 million users
  
9. How many favorites does the system have per day?
    - 1 billion favorites

10. How many total views does the system generate per day?
    - 28 billion views

11. How many tweets are expected to have media files attached and uploaded per day?
    - 20 million

12. What is the average size of media files?
    - 200 kb
      
### Functional Requirements

|      | 
| ----------- | 
| 1. Users can post new tweets.      | 
| 2. Users can follow other users.   | 
| 3. Users can favorite tweets.   | 
| 4. Timeline is generated by the system, consisting of the top tweets of the people followed by the user. |

### Non-Functional Requirements

|      | 
| ----------- | 
| 1. High Reliability  | 
| 2. High Availability   | 
| 3. Low latency: acceptable latency for Timeline generation is 200ms | 
| 4. Scalable |

## Capacity Estimation

### 1. Traffic Estimates

Daily we have 100 million tweets and 28 billion tweet views

Read and write per second:

 - 100 million tweets / (24 * 3600) = 1150 tweets/s

 - 28 billion tweet views / (24 * 3600) = 324000 tweet views/s

### 2. Storage Estimates

Total storage required for 1 month:

 - (100 million * 200 bytes)  + (20 million * 200 kb) * 30 = (20 GB + 4TB) * 30 = 120TB

Total storage required for 1 year:

 - 120TB * (1 year * 12 months) = 1.4 PB

Total storage required for 10 years:

 - 1.4PB * 10 years = 14 PB

### 3. Network Estimates

For write requests per second:

 - 1150 * 200 bytes + 230 * 200 kb = 46 MB/s

For read requests per second:

 - 324000 * 200KB  + 6400 * 200 kb = 1.3 GB/s

### 4. Memory Estimates

We will cache 20% of the requests (following the 80:20 principle where 20% of work provides 80% of the result)

Since we have 100 million requests daily

To cache 20% of the request, the amount of memory needed is:

 - 0.2 * (100 million * 200 bytes + 20 million * 200 kb)  = 800 GB

### High-Level Estimates

| Parameter | Estimates  |
| ----------- | ----------- |
| New tweets uploads | 1150/s       |
| New tweets with media files   | 230/s        |
| Incoming data  | 46 MB/s        |
| Outgoing data  | 1.3 GB/s        |
| Storage data in 1 year | 1.4 PB        |
| Storage data in 10 years | 14 PB        |
| Memory for cache daily | 800 GB        |

## Data Model

What kind of database should we use?

 - Billions of tweets
 - Read-heavy system
 - Media file size can be a few MB.
 - Complex relations like user follow.

For storing user tweets we will use a wide-column database like **Apache Cassandra** for storing images we will use a cloud storage like
**AWS S3**, for complex relations like user follow we will use a graph database like **Neo4j**, for storing user data we can use a relational
database like **PostgreSQL**.

### Database Design

|  Tweet    | 
| ----------- | 
| **Row key: tweet_id**   | 
| Columns: tweet_content, latitude, longitude, content_keys, user_id|

|  User    | 
| ----------- | 
| **UserId: int**   | 
| Name: varchar(20) | 
| Email: varchar(32) |
| CreationDate: DateTime |

|  UserFollows    | 
| ----------- | 
| **Row key: user_id**   | 
| Columns: user_follows|
